<?xml version="1.0" encoding="UTF-8" ?>

<!--
  ~  JavaSMT is an API wrapper for a collection of SMT solvers.
  ~  This file is part of JavaSMT.
  ~
  ~  Copyright (C) 2007-2016  Dirk Beyer
  ~  All rights reserved.
  ~
  ~  Licensed under the Apache License, Version 2.0 (the "License");
  ~  you may not use this file except in compliance with the License.
  ~  You may obtain a copy of the License at
  ~
  ~      http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~  Unless required by applicable law or agreed to in writing, software
  ~  distributed under the License is distributed on an "AS IS" BASIS,
  ~  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~  See the License for the specific language governing permissions and
  ~  limitations under the License.
  -->

<!-- vim: set tabstop=8 shiftwidth=4 expandtab filetype=ant : -->
<project name="jar-yices2" basedir="..">

    <!-- Targets for generating JAR files for Yices2 bindings. -->

    <!-- This is a copy of the default build-jar.xml with some changes. -->

    <!-- These properties can and should be overridden from including file. -->
    <property name="class.main" value=""/>
    <property name="project.url" value=""/>
    <property name="jar.excludesInYices2Jar" value="**/*Test.class **/*Test$*.class"/>

    <target name="jar-yices2" depends="determine-version, build"
              description="Create a runnable JAR file of all classes related to Yices2">
        <property name="yices2jar.file" value="javasmt-yices2-${version}.jar"/>
        <copy todir="${class.dir}"><fileset dir=".." includes="META-INF/**"/></copy>
        <manifestclasspath property="yices2Classpath.jar" jarfile="${ivy.lib.dir}/runtime-yices2/${jar.file}" maxParentLevels="0">
            <classpath><fileset dir="${ivy.lib.dir}/runtime-yices2" includes="checker-qual.jar common.jar guava.jar"/></classpath>
        </manifestclasspath>
        <jar basedir="${class.dir}/"
                destfile="${yices2jar.file}"
                includes="${yices2Classes}"
                excludes="${jar.excludesInYices2Jar}"
                whenmanifestonly="fail">
            <metainf dir=".." includes="LICENSE"/>
            <mappedresources>
                <fileset dir=".." includes="LICENSES/Apache-2.0.txt LICENSES/GPL-3.0-only.txt"/>
                <globmapper from="LICENSES/*" to="META-INF/*"/>
            </mappedresources>
            <manifest>
                <attribute name="Class-Path" value="${yices2Classpath.jar}"/>
                <attribute name="Main-Class" value="${class.main}"/>
                <attribute name="Implementation-Title" value="${ant.project.name} - Yices2"/>
                <attribute name="Implementation-Version" value="${version}"/>
                <attribute name="Implementation-URL" value="${project.url}"/>
            </manifest>
        </jar>
    </target>

    <target name="sources-yices2" depends="determine-version, resolve-dependencies">
        <jar destfile="javasmt-yices2-${version}-sources.jar"
                whenmanifestonly="fail">
            <fileset dir="${source.dir}/" includes="${yices2Sources}"/>
            <fileset dir="${source.generated.dir}/" includes="${yices2Sources}"/>
            <metainf dir=".." includes="LICENSE"/>
            <mappedresources>
                <fileset dir=".." includes="LICENSES/Apache-2.0.txt LICENSES/GPL-3.0-only.txt"/>
                <globmapper from="LICENSES/*" to="META-INF/*"/>
            </mappedresources>
            <manifest>
                    <attribute name="Implementation-Title" value="${ant.project.name} - Yices2"/>
                    <attribute name="Implementation-Version" value="${version}"/>
            </manifest>
        </jar>
    </target>
</project>
